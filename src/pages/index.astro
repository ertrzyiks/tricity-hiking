---
import Layout from '../layouts/Layout.astro';
import { merge } from '../geodata/merge'
import { getCollection, getEntry } from 'astro:content';

import mapImage from '../assets/home-map.jpg'
import { HomeMap } from '../components/HomeMap/HomeMap';

const routes = await getCollection('routes');

const geojsonList = []

for (const route of routes) {
  const geojson = await getEntry(route.data.geojson)
  geojsonList.push(geojson.data)
}

const geojson = merge(geojsonList)
---

<Layout title="Tricity hiking">
  <div class="max-w-screen-xl mx-auto relative h-[70vh]">
    <div class="absolute inset-0 h-full overflow-hidden">
      <img src={mapImage.src} class="absolute blur-2xl inset-0 h-full" />
    </div>

    <HomeMap client:only="preact" routes={geojson} />
  </div>
</Layout>

<style is:global>
  .maplibregl-map {
    height: 100%;
    width: 100%;
  }
</style>
