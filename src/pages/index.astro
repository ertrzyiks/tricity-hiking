---
import Layout from '../layouts/Layout.astro';
import { merge } from '../geodata/merge'
import { getCollection, getEntry } from 'astro:content';

import mapImage from '../assets/home-map.png'
import { HomeMap } from '../components/HomeMap/HomeMap';

const routes = await getCollection('routes');

const geojsonList = []

for (const route of routes) {
  const geojson = await getEntry(route.data.geojson)
  geojsonList.push(geojson.data)
}

const geojson = merge(geojsonList)
---

<Layout title="Tricity hiking">
	<main>
    <h1 class="py-4 px-2">Tricity hiking</h1>

    <div class="max-w-screen-xl mx-auto relative">
      <img src={mapImage.src} class="absolute blur-2xl inset-0" />

      <HomeMap client:only="preact" routes={geojson} />
    </div>
	</main>
</Layout>

<style is:global>
  .maplibregl-map {
    height: 70vh;
    width: 100%;
  }

  .flex-center {
    position: absolute;
    display: flex;
    justify-content: center;
    align-items: center;
  }
</style>
