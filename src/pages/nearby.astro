---
import { getCollection, getEntry } from "astro:content";
import Layout from "../layouts/Layout.astro";
import Homepage from "../components/ui/Homepage.astro";
import { enhance } from "../services/enhance";
import { getLineStringFeature } from "../services/getLineStringFeature";
import RouteListItem from "../components/ui/ListCardItem/Route.astro";

const allRoutes = await getCollection("routes");
const routes = allRoutes.filter((route) => {
  return !route.data.draft;
});

const nearbyRoutes = routes.filter((route) => !route.data.tricity);

const geojsonList = [];

for (const route of nearbyRoutes) {
  const geojson = await getEntry(route.data.geojson);
  const enhancedGeojson = enhance({
    collection: geojson.data,
    route: route.data,
  });
  geojsonList.push({
    route,
    properties:
      getLineStringFeature({ collection: enhancedGeojson })?.properties ?? {},
  });
}
---

<Layout
  title="List of the best hiking trails in GdaÅ„sk, Sopot, Gdynia and nearby"
>
  <Homepage>
    <div class="max-w-(--breakpoint-xl) mx-auto relative px-2 lg:px-0">
      <ul>
        {
          geojsonList.map(({ route, properties }) => (
            <RouteListItem route={route} properties={properties} />
          ))
        }
      </ul>
    </div>
  </Homepage>
</Layout>
